


const productData = [
    {
        productDescription: {
            span: "1",
            name: "ИС-64",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 1,
    },
    {
        productDescription: {
            span: "2",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 2,
    },
    {
        productDescription: {
            span: "2",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 3,
    },
    {
        productDescription: {
            span: "2",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 4,
    },
    {
        productDescription: {
            span: "2",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 5,
    },
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 6,
    },
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 7,
    },
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 8,
    }
    ,
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 9,
    }
    ,
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 10,
    }
    ,
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 11,
    }
    ,
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 12,
    }
    ,
    {
        productDescription: {
            span: "1",
            name: "ИС-6",
            type: "",
            country: "",
            description: "Premium Account allows to research desirable vehicles quicker and to save time on its purchase. It gives more Credits and Experience per battle.  It is a great deal as the profit after paying for repairs and ammo increases two- or threefold, depending on your performance in battle (amount of damage, destroyed enemies, base captured/defended, " +
                "enemies detected, etc).",
        },
        productImage: "https://ru-wotp.wgcdn.co/dcont/fb/image/r165_object_703_ii_1300_big_1.png",
        productCost: "$ 58.99",
        productID: 13,
    }
]
const userDate = {
    wishlist: [],
    shopping: [],
}
const errorMessage = "передан недействительный идентификатор продукта"
function createError(massage, data) {
    return {
        massage,
        data
    }
}
class Item {
    #productData = []
    #userDate = {
        wishlist: [],
        shopping: [],
    }
    setData() {
        //добавить запрос на сервер дляполучения данных
        this.#productData = productData
        this.#userDate = userDate
    }
    wishlistInitial() {
        const $wishlist = document.getElementById("wishlistId")
        $wishlist.innerText = `(${this.#userDate.wishlist.length})`
    }
    shoppingInitial() {
        const $shopping = document.getElementById("shoppingId")
        $shopping.innerText = `(${this.#userDate.shopping.length})`
    }
    createItem(itemId) {
        const $container = document.getElementsByClassName(`mainContainer`)
        let itemData = this.#productData.filter((product) => product.productID === itemId)
        const $item = document.createElement('main');
        $item.classList.add('mainItemContent')
        if (!itemData.length) {
            $item.innerHTML = `<p style="min-height: 100vh">Продукт не найден</p>`
            $container[0].append($item)
            throw createError(errorMessage,itemId)
        }
        itemData = itemData[0]
        $item.innerHTML = `
            <h2>${itemData.productDescription.name}</h2>
            <img src=${itemData.productImage} alt="${itemData.productDescription.name}"/>
            <div class="purchaseContainer">
                <span class="priceItem">${itemData.productCost}</span>
                <button class="purchaseButton">purchase</button>
            </div>
            <p class="itemDescription">${itemData.productDescription.description}</p>`

        const $button = $item.querySelector("button")
        const $img = $item.querySelector("img")
        $button.addEventListener("click", (event) => {
            moveProduct($img,"shoppingId","bodyId","moveProductItem")
            userDate.shopping.push(itemData)
            this.shoppingInitial()
        }, false)


        $container[0].append($item)

        /*while ($container.firstChild) {
            $parent.removeChild($parent.firstChild);
        }
        $parent.append($item)
        */

    }

}
function moveProduct($product, targetID, parentID, style = null, additionalStyles = null) {
    const $moveProduct = $product.cloneNode(true);
    //определение размеров и положения продукта для анимации
    let {left: leftProduct, top: topProduct, height: heightProduct, width: widthProduct} = $product.getBoundingClientRect()
    //определение размеров и положения цели для анимации

    // объект по targetID расположен в заголовке с position: fixed в верхней части экрана
    const {left, top, height, width} = document.getElementById(targetID).getBoundingClientRect()

    //добавление стиля для объекта анимации
    if (style) $moveProduct.classList.add(style)
    // смещение положения старта анимации в случае если прототип анимации сместился за видимую часть экрана
    if ((topProduct + heightProduct * 0.75) < top) {
        const {clientWidth, clientHeight} = document.documentElement
        topProduct = (clientHeight - heightProduct)/2
        leftProduct =(clientWidth - widthProduct)/2
    }
    //добавлене дополнительных переданных стилей по типу [{name:название, property:значение}] значения - строки
    if (additionalStyles) {
        additionalStyles.forEach(value => {
            $moveProduct.style[value.name] = value.property
        })
    }
    //установка layout для анимации
    $moveProduct.style.width = `${widthProduct}px`
    $moveProduct.style.height = `${heightProduct}px`
    $moveProduct.style.top = `${topProduct}px`
    $moveProduct.style.left = `${leftProduct}px`

    //нахождение родительского контейнера для анимации
    const $parent = document.getElementById(parentID)

    //определяем список правил CSS документа
    let styleSheet = document.styleSheets[0];
    //создаем уникальное имя анимации
    let animationName = `keyframe${Date.now()}`
    //определяем параметры необходимой анимации
    let keyframes =
        `@-webkit-keyframes ${animationName} {
                     100% {transform: translate3d(${left + width / 2 - widthProduct / 2 - leftProduct}px, ${top + height / 2 - heightProduct / 2 - topProduct}px, 0px) scale3d(0.1,0.1,0.1) rotate(360deg)}
                 }`
    //добавляем правило @-webkit-keyframes в список правил CSS документа
    styleSheet.insertRule(keyframes, styleSheet.cssRules.length);
    //устанавливаем правила выполнения анимации для анимируемого объекта
    $moveProduct.style.animation = `${animationName} 1.5s ease-in-out `
    // подписываемся на окончание анимации
    $moveProduct.addEventListener("animationend", () => {
        // находим добавленный @-webkit-keyframes, сохраненный в document.styleSheets
        let index = null
        for (let i = 0; i < styleSheet.cssRules.length; i++) {
            if (styleSheet.rules[i].name) {
                if (styleSheet.rules[i].name === animationName) {
                    //нахождение анимации по имени стиля  и опредление его индекса в таблице стилей
                    index = i
                }
            }
        }
        if (index !== null) {
            //если стиль найден  - удаляем его из таблице по индексу
            styleSheet.deleteRule(index)
        }
        //удаляем  обьект созданный для анимации
        $moveProduct.remove()
    })


    //коостыль добавления анимации на setTimeout
    /* setTimeout(() => {
         $moveProduct.style.transform = `translate3d(${left + width / 2 - widthProduct / 2 - leftProduct}px, ${top + height / 2 - heightProduct / 2 - topProduct}px, 0px)
          scale3d(0.1,0.1,0.1) rotate(360deg)`
         $moveProduct.style.opacity = 0.2
         $moveProduct.addEventListener("transitionend", () => {
             $moveProduct.remove()
         })
     })*/
    $parent.append($moveProduct)
}

const item= new Item()
item.setData()
item.createItem(2)
